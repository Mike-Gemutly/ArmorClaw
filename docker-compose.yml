# Docker Compose: ArmorClaw Full Stack (Meta-Composition)
# Part of Topology Separation (G-06)
#
# This file provides convenient presets for running the full stack.
# For production deployments, use the individual stack files:
#
#   Matrix Stack:  docker-compose -f docker-compose.matrix.yml up -d
#   Bridge Stack:  docker-compose -f docker-compose.bridge.yml up -d
#   Full Stack:    docker-compose --profile full up -d
#
# Topology Overview:
#   ┌─────────────────────────────────────────────────────────────┐
#   │                        HOST MACHINE                          │
#   │  ┌─────────────────┐                                        │
#   │  │ ArmorClaw Bridge│ ← Unix Socket /run/armorclaw/bridge.sock│
#   │  │ (Native Binary) │                                        │
#   │  └────────┬────────┘                                        │
#   │           │                                                   │
#   │  ┌────────▼────────────────────────────────────────────────┐ │
#   │  │              matrix-net (172.20.0.0/24)                  │ │
#   │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │ │
#   │  │  │   Nginx     │  │  Conduit    │  │   Coturn    │     │ │
#   │  │  │  (Proxy)    │  │ (Matrix HS) │  │  (TURN/STUN)│     │ │
#   │  │  └─────────────┘  └─────────────┘  └─────────────┘     │ │
#   │  └──────────────────────────────────────────────────────────┘ │
#   │           │                                                   │
#   │  ┌────────▼────────────────────────────────────────────────┐ │
#   │  │              bridge-net (172.21.0.0/24) [internal]      │ │
#   │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │ │
#   │  │  │   Sygnal    │  │ mautrix-*   │  │   Agents    │     │ │
#   │  │  │ (Push GW)   │  │  (Bridges)  │  │  (Docker)   │     │ │
#   │  │  └─────────────┘  └─────────────┘  └─────────────┘     │ │
#   │  └──────────────────────────────────────────────────────────┘ │
#   └─────────────────────────────────────────────────────────────┘
#
# Network Security:
#   - matrix-net: Exposed via Nginx (80/443)
#   - bridge-net: Internal only (no external access)
#   - Bridge on host: Unix socket only (no network exposure)

# Include both stacks
include:
  - docker-compose.matrix.yml
  - docker-compose.bridge.yml

# ========================================
# Management Commands (via docker-compose)
# ========================================
#
# Start Matrix stack only:
#   docker-compose -f docker-compose.matrix.yml up -d
#
# Start Bridge stack only:
#   docker-compose -f docker-compose.bridge.yml up -d
#
# Start full stack:
#   docker-compose up -d
#
# Start with optional bridges (Slack, Discord, etc.):
#   docker-compose --profile slack up -d
#   docker-compose --profile discord up -d
#   docker-compose --profile telegram up -d
#   docker-compose --profile whatsapp up -d
#
# View logs:
#   docker-compose logs -f matrix-conduit
#   docker-compose logs -f sygnal
#
# Stop all:
#   docker-compose down
#
# Stop and remove volumes:
#   docker-compose down -v

# ========================================
# Health Check Script
# ========================================
#
# Verify all services are healthy:
#   ./deploy/health-check.sh
#
# Or manually:
#   curl -f http://localhost/_matrix/client/versions
#   curl -f http://localhost:5000/_matrix/push/v1/notify
#   curl -f http://localhost/health
