# Coturn TURN Server Configuration for ArmorClaw
# STUN/TURN server for WebRTC voice/video

# ========================================
# NETWORK SETTINGS
# ========================================
listening-port=3478
tls-listening-port=5349
alt-listening-port=0
alt-tls-listening-port=0

# Use standard listening port (3478)
# Will be determined at runtime
# external-ip=<auto-detected>
relay-ip=0.0.0.0
listening-ip=0.0.0.0

# ========================================
# REALM CONFIGURATION
# ========================================
realm=${MATRIX_SERVER_NAME}
server-name=${MATRIX_SERVER_NAME}

# ========================================
# AUTHENTICATION
# ========================================
use-auth-secret
static-auth-secret=${TURN_SECRET}

# Auth credentials lifetime
stale-nonce=600

# ========================================
# TLS/DTLS
# ========================================
# Certbot certificates
cert=/etc/letsencrypt/live/${MATRIX_SERVER_NAME}/fullchain.pem
pkey=/etc/letsencrypt/live/${MATRIX_SERVER_NAME}/privkey.pem

# Cipher suites
cipher-list="ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384"

# DH parameters (generate with: openssl dhparam -out dhparam.pem 2048)
# dh-file=/etc/coturn/dhparam.pem

# ========================================
# PERFORMANCE
# ========================================
# Relay threads
relay-threads=4

# Total allocation quota
total-quota=100
per-user-quota=10

# Max bandwidth per session (bytes/sec)
max-bps=0  # Unlimited

# Rate limits
bps-capacity=0
bps-rate-limit=0

# ========================================
# TIMEOUTS
# ========================================
# Session lifetime
max-session-lifetime=86400  # 24 hours

# Channel binding lifetime
channel-lifetime=600
permission-lifetime=300

# ========================================
# LOGGING
# ========================================
log-file=stdout
no-stdout-log
verbose
Verbose

# ========================================
# SECURITY
# ========================================
# Deny specific IP ranges
denied-peer-ip=0.0.0.0-0.255.255.255
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=100.64.0.0-100.127.255.255
denied-peer-ip=127.0.0.0-127.255.255.255
denied-peer-ip=169.254.0.0-169.254.255.255
denied-peer-ip=172.16.0.0-172.31.255.255
denied-peer-ip=192.0.0.0-192.0.0.255
denied-peer-ip=192.0.2.0-192.0.2.255
denied-peer-ip=192.88.99.0-192.88.99.255
denied-peer-ip=192.168.0.0-192.168.255.255
denied-peer-ip=198.18.0.0-198.19.255.255
denied-peer-ip=198.51.100.0-198.51.100.255
denied-peer-ip=203.0.113.0-203.0.113.255
denied-peer-ip=240.0.0.0-255.255.255.255

# Allow loopback for health checks
allowed-peer-ip=127.0.0.1

# Deny IPv6 private ranges
denied-peer-ip=::1
denied-peer-ip=64:ff9b::-64:ff9b:1:ffff:ffff:ffff:ffff:ffff
denied-peer-ip=::ffff:0:0-::ffff:255:255:255:255
denied-peer-ip=::%-::ffff:0:ffff
denied-peer-ip=100::-100::ffff:ffff:ffff:ffff:ffff:ffff
denied-peer-ip=2001::-2001:1ff:ffff:ffff:ffff:ffff:ffff:ffff
denied-peer-ip=2001:db8::-2001:db8:ffff:ffff:ffff:ffff:ffff:ffff
denied-peer-ip=2002::-2002:ffff:ffff:ffff:ffff:ffff:ffff:ffff
denied-peer-ip=fc00::-fdff:ffff:ffff:ffff:ffff:ffff:ffff:ffff
denied-peer-ip=fe80::-febf:ffff:ffff:ffff:ffff:ffff:ffff:ffff

# ========================================
# FINGERPRINT
# ========================================
fingerprint

# ========================================
# DAEMON OPTIONS
# ========================================
no-cli
no-multicast-peers
no-tlsv1
no-tlsv1_1

# ========================================
# WEBRTC SPECIFIC
# ========================================
# Enable long-term credential mechanism
lt-cred-mech

# Enable TURN REST API (for dynamic credentials)
# rest-api-separator=:

# Mobility (ICE MOBILITY extension)
mobility

# Enable TURN relay to loopback addresses (for testing)
# allow-loopback-peers
