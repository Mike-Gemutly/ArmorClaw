# PostgreSQL Configuration for Matrix Homeserver
# Optimized for Matrix workloads

# ========================================
# CONNECTION SETTINGS
# ========================================
listen_addresses = '*'
port = 5432
max_connections = 200

# ========================================
# MEMORY SETTINGS (for 256MB limit)
# ========================================
shared_buffers = 64MB
effective_cache_size = 192MB
work_mem = 2MB
maintenance_work_mem = 64MB

# ========================================
# WAL SETTINGS
# ========================================
wal_buffers = 4MB
checkpoint_completion_target = 0.9
max_wal_size = 1GB
min_wal_size = 256MB

# ========================================
# QUERY PLANNING
# ========================================
random_page_cost = 1.1  # SSD optimization
effective_io_concurrency = 200

# ========================================
# LOGGING
# ========================================
log_destination = 'stderr'
logging_collector = off
log_min_duration_statement = 1000  # Log slow queries (>1s)
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on

# ========================================
# SECURITY
# ========================================
ssl = off  # Handled by Nginx
password_encryption = scram-sha-256

# ========================================
# LOCALE
# ========================================
lc_messages = 'C'
lc_monetary = 'C'
lc_numeric = 'C'
lc_time = 'C'
